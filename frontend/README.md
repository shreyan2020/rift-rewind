# Rift Rewind Frontend

React + TypeScript frontend for the Rift Rewind experience - an immersive narrative journey through League of Legends ranked matches, powered by AI.

## ğŸ¨ Tech Stack

- **React 19**: Modern React with hooks and concurrent features
- **TypeScript**: Type-safe development
- **Vite**: Lightning-fast build tool and dev server
- **Tailwind CSS**: Utility-first styling with custom Runeterra theme
- **Framer Motion**: Smooth animations and transitions
- **Recharts**: Interactive data visualizations
- **Axios**: HTTP client for API communication
- **Lucide React**: Beautiful, consistent icon set

## ğŸ“– Understanding Your Journey

Before diving in, let's clarify the core concepts:

### What is a Quarter?

Your 2025 ranked season is divided into **four quarters** based on the calendar year:

- **Q1** (Chapter 1): **January through March** - Your journey begins
- **Q2** (Chapter 2): **April through June** - Growth and adaptation
- **Q3** (Chapter 3): **July through September** - Challenges and trials
- **Q4** (Chapter 4): **October through December** - Mastery and resolution

Each quarter represents approximately 3 months of your gameplay and becomes one **chapter** in your Runeterra story.

### Quarter = Chapter

Throughout this documentation, you'll see the terms **"quarter"** and **"chapter"** used interchangeably:
- **Technical term**: Quarter (Q1, Q2, Q3, Q4)
- **Narrative term**: Chapter (your story progression)
- They mean the same thing: a 3-month period of your season that becomes one act in your journey

### Why Quarters?

Dividing your season into quarters provides:
- **Natural progression**: Each quarter can show growth or change
- **Manageable analysis**: ~15-50 games per period for meaningful stats
- **Story structure**: Creates a 4-act narrative arc (Setup â†’ Growth â†’ Challenge â†’ Resolution)
- **Regional mapping**: Each quarter gets its own Runeterra region based on your evolving playstyle

### The Journey Flow

Your complete experience follows this path:

```
Start â†’ Q1 (Chapter 1) â†’ Q2 (Chapter 2) â†’ Q3 (Chapter 3) â†’ Q4 (Chapter 4) â†’ Finale â†’ Insights
```

Each quarter gives you:
- A **Runeterra region** (dynamically chosen based on your playstyle)
- An **AI-generated story** about your time in that region
- **Performance statistics** for those months
- **Role-specific feedback** on your gameplay
- Your **top 3 playstyle values** for that period

## âœ¨ Features

### 1. **Three Usage Modes**

#### Mode 1: Fetch from Riot API
- Enter summoner name and region
- Backend fetches ranked matches from 2025
- Processes quarters sequentially (Q1 â†’ Q2 â†’ Q3 â†’ Q4)
- Real-time status polling with visual feedback
- Optional cache bypass for fresh data

#### Mode 2: Upload Pre-fetched Matches
- Upload `journey-upload.json` (generated by local scripts)
- Supports two formats:
  - **Complete journey package** (instant display, no backend processing)
  - **Raw matches** (Q1-Q4 match data sent to backend for processing)
- Useful for testing or offline processing

#### Mode 3: Friend Comparison
- Upload two complete journey files
- Side-by-side statistics comparison
- AI-generated relationship lore (Allies vs Rivals)
- Interactive value and stat analysis
- Exportable comparison reports

### 2. **Journey Experience**

- **Quarterly Narratives**: Each quarter mapped to a Runeterra region
- **AI-Generated Lore**: Contextual stories based on playstyle
- **Performance Stats**: KDA, CS/min, vision, gold, role-specific metrics
- **Playstyle Values**: Top 3 psychological values per quarter
- **Role Reflections**: Personalized feedback for your position
- **Interactive Navigation**: Progress through Q1 â†’ Q2 â†’ Q3 â†’ Q4 â†’ Finale

### 3. **Final Dashboard**

- **Consolidated Finale**: AI-generated season summary
- **Performance Trends**: Line charts showing progression across quarters
- **Champion Analysis**: Top champions, versatility, one-tricks
- **Highlights**: Best games, pentakills, perfect games, first bloods
- **Comeback Tracking**: Resilience score and comeback victories
- **Insights**: AI-generated observations and growth areas
- **Downloadable Report**: Export complete journey as JSON

## ğŸ“ Project Structure

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Journey.tsx            # Main journey orchestrator
â”‚   â”‚   â”œâ”€â”€ ChapterView.tsx        # Individual quarter display
â”‚   â”‚   â”œâ”€â”€ FinalDashboard.tsx     # Season finale with charts
â”‚   â”‚   â”œâ”€â”€ InsightsView.tsx       # Detailed insights breakdown
â”‚   â”‚   â”œâ”€â”€ FriendComparison.tsx   # Friend comparison mode
â”‚   â”‚   â””â”€â”€ ShareableReport.tsx    # Exportable journey report
â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â””â”€â”€ valueDescriptions.ts   # Playstyle value explanations
â”‚   â”œâ”€â”€ api.ts                     # API client and type definitions
â”‚   â”œâ”€â”€ App.tsx                    # Entry point with mode selection
â”‚   â”œâ”€â”€ main.tsx                   # React root
â”‚   â””â”€â”€ index.css                  # Global styles + Tailwind
â”œâ”€â”€ public/                        # Static assets
â”œâ”€â”€ index.html                     # HTML entry point
â”œâ”€â”€ package.json                   # Dependencies
â”œâ”€â”€ tsconfig.json                  # TypeScript configuration
â”œâ”€â”€ tailwind.config.js             # Tailwind + custom Runeterra theme
â”œâ”€â”€ vite.config.ts                 # Vite build configuration
â””â”€â”€ eslint.config.js               # ESLint rules
```

## ğŸ§© Key Components

### `App.tsx`
**Purpose**: Entry point with mode selection and form handling

**Features**:
- Mode tabs (API Fetch / Upload / Compare)
- Summoner input form with region and archetype selection
- File upload handler with format validation
- Cache bypass option
- Journey initialization

**State Management**:
- `mode`: Current mode ('api' | 'upload' | 'compare')
- `jobId`: Active journey job ID
- `formData`: User input (riotId, platform, archetype)
- `uploadedFile`: Uploaded match/journey data
- `bypassCache`: Force fresh data fetch

---

### `Journey.tsx`
**Purpose**: Orchestrates the entire journey experience from Q1 to finale

**Responsibilities**:
- Poll job status every 3 seconds (when using API mode)
- Load quarter data when status changes to 'ready'
- Handle uploaded journey data (instant display, no polling)
- Manage chapter navigation
- Load and display finale after Q4 completion
- Handle journey reset

**State**:
- `jobStatus`: Current job and quarter statuses from backend
- `currentChapter`: Active chapter ('Q1' | 'Q2' | 'Q3' | 'Q4' | 'FINAL' | 'INSIGHTS')
- `chapterData`: Loaded quarter stories (Record<string, Quarter>)
- `finaleData`: Final summary data with trends and highlights

**Chapter Flow**:
```
Q1 â†’ Q2 â†’ Q3 â†’ Q4 â†’ Final Dashboard â†’ Insights View
```

---

### `ChapterView.tsx`
**Purpose**: Display individual quarter with region-specific theming and narrative

**Features**:
- **Dynamic Region Themes**: Background gradients for Demacia, Noxus, Ionia, Freljord, etc.
- **Animated Lore**: Typewriter effect for immersive storytelling
- **Performance Stats Grid**: Games, KDA, CS/min, vision, gold, role-specific metrics
- **Top Values Display**: 3 key playstyle values with descriptions
- **Role Reflection**: Position-specific performance feedback
- **Chapter Navigation**: Progress indicator and next chapter button

**Region Themes**:
- Demacia: Blue/gold (justice, order)
- Noxus: Red/black (strength, conquest)
- Ionia: Pink/purple (balance, spirituality)
- Piltover: Brass/cyan (progress, innovation)
- Zaun: Green/toxic (survival, chaos)
- Freljord: Ice blue (endurance, tradition)
- Shurima: Golden/sand (glory, legacy)
- Bilgewater: Teal/pirate (adventure, freedom)
- Shadow Isles: Dark green/spectral (darkness, haunting)
- Targon: Purple/celestial (aspiration, divinity)

---

### `FinalDashboard.tsx`
**Purpose**: Comprehensive season summary with visualizations and final lore

**Features**:
- **Final Lore**: AI-generated conclusion of the journey
- **Season Stats Summary**: Total games, averages, best quarter
- **Trend Charts**: Line graphs for KDA, CS, gold, vision progression
- **Value Evolution**: Bar chart showing top values across quarters
- **Champion Analysis**: 
  - Top champions with games, KDA, win rate
  - One-tricks identification
  - Versatility score
- **Highlights Section**:
  - Best KDA game
  - Most kills/damage games
  - Perfect games (0 deaths)
  - Pentakills and first bloods
- **Comeback Analysis**: Resilience score and comeback victories
- **AI Insights**: High-priority observations and growth areas
- **Consolidated Reflections**: Bullet-point summaries from all quarters
- **Export Button**: Download complete journey as JSON

---

### `FriendComparison.tsx`
**Purpose**: Compare two players' journeys with AI-generated narrative

**Features**:
- **Dual File Upload**: Upload two journey JSON files
- **Similarity Calculation**: Cosine similarity of playstyle values
- **Relationship Type**: Automatically determined (Allies >0.7, Rivals â‰¤0.7)
- **AI Comparison Lore**: Generated narrative about the players' relationship
- **Side-by-Side Stats**: Visual comparison of performance metrics
- **Interactive Charts**:
  - Value comparison (spider chart style)
  - Stats comparison (bar charts)
  - Trend line comparisons
- **Export Comparison**: Save comparison report to `friend1/` and `friend2/` folders

**Workflow**:
1. Upload Player 1's journey JSON
2. Upload Player 2's journey JSON
3. System calculates similarity
4. Generate AI lore about relationship
5. View interactive comparisons
6. Export results

---

### `InsightsView.tsx`
**Purpose**: Detailed breakdown of AI-generated insights and growth areas

**Features**:
- Priority-sorted insights (high/medium/low)
- Strengths and achievements
- Growth areas and recommendations
- Overall season trend analysis
- Navigate back to finale

---

### `ShareableReport.tsx`
**Purpose**: Generate downloadable journey packages

**Features**:
- Exports complete journey data
- Includes metadata, quarters, finale
- Can be re-uploaded for instant viewing
- Format compatible with friend comparison

## ğŸ”Œ API Integration

### Base URL Configuration

Update in `src/api.ts`:
```typescript
const API_BASE_URL = 'https://your-api-id.execute-api.your-region.amazonaws.com';
```

### Type Definitions

```typescript
interface JourneyRequest {
  platform: string;        // 'euw1', 'na1', 'kr', etc.
  riotId: string;          // 'Name#TAG'
  archetype: string;       // 'explorer', 'warrior', 'sage', 'guardian'
  bypassCache?: boolean;   // Force fresh data fetch
}

interface Quarter {
  quarter: string;         // 'Q1', 'Q2', 'Q3', 'Q4'
  region: string;          // 'Demacia', 'Noxus', etc.
  lore: string;            // AI-generated narrative
  reflection: string;      // Role-specific feedback
  stats: {
    games: number;
    kda_proxy: number;
    cs_per_min: number;
    gold_per_min: number;
    vision_score_per_min: number;
    ping_rate_per_min: number;
    primary_role: string;  // 'SUPPORT', 'JUNGLE', etc.
    obj_damage_per_min?: number;
    kill_participation?: number;
    control_wards_per_game?: number;
  };
  values: Record<string, number>;     // All playstyle values
  top_values: [string, number][];     // Top 3 values with scores
  top_champions: Array<{
    name: string;
    games: number;
  }>;
}

interface Finale {
  lore: string;
  final_reflection: string[];         // Bullet points
  total_games: number;
  quarters: Quarter[];                // All 4 quarters
  
  // Advanced analytics (optional)
  trends?: {
    kda_trend: { direction: string; change_percentage: number; best_quarter: string };
    cs_trend: { direction: string; change_percentage: number; best_quarter: string };
    gold_trend: { direction: string; change_percentage: number; best_quarter: string };
    vision_trend: { direction: string; change_percentage: number; best_quarter: string };
  };
  
  highlights?: {
    best_kda_game: any;
    most_kills_game: any;
    most_damage_game: any;
    perfect_games: number;
    first_bloods: number;
    pentakills: number;
  };
  
  champion_analysis?: {
    top_champions: Array<{
      name: string;
      games: number;
      avg_kda: number;
      win_rate: number;
    }>;
    one_tricks: string[];
    versatility_score: number;
  };
  
  comebacks?: {
    comeback_games: any[];
    total_comebacks: number;
    resilience_score: number;
  };
  
  insights?: Array<{
    insight: string;
    priority: 'high' | 'medium' | 'low';
  }>;
  
  year_summary?: {
    total_games: number;
    year_avg_kda: number;
    year_avg_cs_per_min: number;
    year_avg_vision_score: number;
    total_unique_champions: number;
    most_played_champion: string;
    comeback_victories: number;
    resilience_score: number;
    achievements: string[];
    strengths: string[];
    growth_areas: string[];
    overall_trend: string;
    best_quarter: string;
  };
}

interface JobStatus {
  jobId: string;
  riotId: string;
  platform: string;
  archetype: string;
  status: string;
  quarters: {
    Q1: 'pending' | 'fetching' | 'fetched' | 'ready' | 'error';
    Q2: 'pending' | 'fetching' | 'fetched' | 'ready' | 'error';
    Q3: 'pending' | 'fetching' | 'fetched' | 'ready' | 'error';
    Q4: 'pending' | 'fetching' | 'fetched' | 'ready' | 'error';
  };
  s3Base: string;
}
```

### API Functions

```typescript
// Create new journey (API fetch mode)
createJourney(request: JourneyRequest): Promise<{ jobId: string; queued: boolean }>

// Upload pre-fetched matches
createJourneyFromUpload(request: UploadJourneyRequest): Promise<{ jobId: string; queued: boolean }>

// Poll job status
getJobStatus(jobId: string): Promise<JobStatus>

// Load quarter story from S3
getQuarterStory(bucketUrl: string, quarter: string): Promise<Quarter>

// Load finale from S3
getFinale(bucketUrl: string): Promise<Finale>
```

### Endpoints

**Backend API** (`infra/src/api.py`):
- `POST /journey` - Create journey from Riot API
- `POST /journey/upload` - Create journey from uploaded matches
- `GET /status/{jobId}` - Get job and quarter statuses

**S3 Bucket** (public read for story files):
- `https://{bucket}.s3.{region}.amazonaws.com/{jobId}/Q1/story.json`
- `https://{bucket}.s3.{region}.amazonaws.com/{jobId}/Q2/story.json`
- `https://{bucket}.s3.{region}.amazonaws.com/{jobId}/Q3/story.json`
- `https://{bucket}.s3.{region}.amazonaws.com/{jobId}/Q4/story.json`
- `https://{bucket}.s3.{region}.amazonaws.com/{jobId}/finale.json`

## ğŸš€ Development

### Installation

```bash
cd frontend
npm install
```

### Running Locally

```bash
npm run dev
```

Opens at `http://localhost:5173`

### Building for Production

```bash
npm run build
```

Output in `dist/` directory.

### Linting

```bash
npm run lint
```

### Preview Production Build

```bash
npm run preview
```

## ğŸ“¦ Deployment

### Prerequisites

1. Backend deployed and API Gateway URL available
2. S3 bucket for frontend hosting configured
3. S3 bucket policy allows public read

### Steps

1. **Update API endpoint** in `src/api.ts`:
   ```typescript
   const API_BASE_URL = 'https://your-actual-api-id.execute-api.region.amazonaws.com';
   ```

2. **Build for production**:
```bash
npm run build
```

3. **Deploy to S3**:
```bash
aws s3 sync dist/ s3://your-frontend-bucket --delete --region your-region
```

4. **Configure S3 static website hosting**:
   - Enable static website hosting
   - Set index document: `index.html`
   - Set error document: `index.html` (for SPA routing)

5. **(Optional) Set up CloudFront** for CDN and HTTPS

### Deployment Script

Use the provided deployment scripts:

**Linux/Mac**:
```bash
chmod +x deploy.sh
./deploy.sh
```

**Windows**:
```powershell
.\deploy.ps1
```

## ğŸ¨ Theming

### Custom Runeterra Colors

Defined in `tailwind.config.js`:

```javascript
colors: {
  'runeterra-darker': '#0a0e1a',
  'runeterra-dark': '#1a1e2e',
  'runeterra-gold': '#c8aa6e',
  'runeterra-gold-light': '#f0e6d2',
  // ... region-specific colors
}
```

### Region Background Gradients

Each region has a unique gradient defined in `ChapterView.tsx`:
- **Demacia**: Blue â†’ Gold
- **Noxus**: Red â†’ Crimson
- **Ionia**: Pink â†’ Purple
- **Piltover**: Bronze â†’ Cyan
- And more...

## ğŸ› Troubleshooting

### Issue: API calls failing with CORS error

**Cause**: API Gateway CORS not configured properly

**Solution**:
1. Check `infra/template.yaml` CORS settings
2. Verify API Gateway allows `*` origins (or specific frontend domain)
3. Ensure response headers include Access-Control-Allow-Origin

---

### Issue: Blank page after deployment

**Cause**: React Router/SPA routing not configured

**Solution**:
1. Set S3 error document to `index.html`
2. Ensure Vite base URL is correct in `vite.config.ts`
3. Check browser console for errors

---

### Issue: Finale not loading (403 Forbidden)

**Cause**: S3 bucket policy doesn't allow public read

**Solution**:
Apply bucket policy from root `bucket-policy.json`:
```bash
aws s3api put-bucket-policy \
  --bucket rift-rewind-data-{account}-{region} \
  --policy file://bucket-policy.json
```

---

### Issue: Friend comparison not generating lore

**Cause**: Backend Bedrock API not invoked or permissions issue

**Solution**:
1. Check CloudWatch logs for ProcessQuarter Lambda
2. Verify Bedrock permissions in IAM role
3. Ensure Mistral model is available in your AWS region

---

### Issue: Upload mode not working

**Cause**: Invalid JSON format or missing required fields

**Solution**:
Uploaded file must contain either:
- **Complete journey package**: `{ type: 'complete-journey', metadata: {...}, quarters: {...}, finale: {...} }`
- **Raw matches**: `{ Q1: [...], Q2: [...], Q3: [...], Q4: [...] }`

---

### Issue: Stats look incorrect or outdated

**Cause**: Cached job data from before bug fixes

**Solution**:
Check "Force refresh (bypass cache)" when creating journey to fetch fresh data.

## ğŸ“š Related Documentation

- **Backend/Infrastructure**: See [`../infra/README.md`](../infra/README.md) for Lambda functions, API details, and deployment
- **Main Project**: See [`../README.md`](../README.md) for overall architecture, features, and getting started guide

## ğŸ§ª Testing

### Manual Testing Checklist

- [ ] API Fetch mode with valid summoner
- [ ] API Fetch with invalid summoner (error handling)
- [ ] Upload mode with complete journey package
- [ ] Upload mode with raw matches
- [ ] Friend comparison with two valid journeys
- [ ] Cache bypass functionality
- [ ] Journey export and re-import
- [ ] Navigation between chapters
- [ ] Finale visualization and charts
- [ ] Mobile responsiveness

### Test Data

Use provided test files in project root:
- `friend1/` - Sample journey for Friend 1
- `friend2/` - Sample journey for Friend 2

## ğŸ¤ Contributing

When modifying the frontend:

1. Maintain TypeScript types in `api.ts`
2. Follow existing component patterns
3. Use Tailwind classes for styling
4. Test all three modes (API, Upload, Compare)
5. Ensure mobile responsiveness
6. Update this README if adding features

## ğŸ“„ License

This project is for educational purposes. League of Legends and Riot Games are trademarks of Riot Games, Inc.

---

**Built with â¤ï¸ for League of Legends players**

*Transform your matches into an epic journey through Runeterra!*
